<!DOCTYPE html><html><head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Docker 学习笔记 | Yo42 | Dont't Panic,Do not go gentle into that good night~</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Technology">
    <meta name="description" content="Docker有两个概念需要搞清楚,镜像与容器。 12镜像是从网上docker pub上拉取下来的镜像，拉取下来后可以使用docker run命令进行运行。# dockerhub 是官方构建的一个镜像仓库,类似github一样,上面累积了许多人上传制作的镜像,有官方,有的是用户上传的,任何人都可自由下载。 1容器是将镜像运行在一个容器中 Registry 123用户可以在自己的数据中心搭建私有的re">
<meta name="keywords" content="Technology">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 学习笔记">
<meta property="og:url" content="https://yo42.github.io/2018/09/09/Docker-学习笔记/index.html">
<meta property="og:site_name" content="Yo42">
<meta property="og:description" content="Docker有两个概念需要搞清楚,镜像与容器。 12镜像是从网上docker pub上拉取下来的镜像，拉取下来后可以使用docker run命令进行运行。# dockerhub 是官方构建的一个镜像仓库,类似github一样,上面累积了许多人上传制作的镜像,有官方,有的是用户上传的,任何人都可自由下载。 1容器是将镜像运行在一个容器中 Registry 123用户可以在自己的数据中心搭建私有的re">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-09-09T10:03:45.823Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker 学习笔记">
<meta name="twitter:description" content="Docker有两个概念需要搞清楚,镜像与容器。 12镜像是从网上docker pub上拉取下来的镜像，拉取下来后可以使用docker run命令进行运行。# dockerhub 是官方构建的一个镜像仓库,类似github一样,上面累积了许多人上传制作的镜像,有官方,有的是用户上传的,任何人都可自由下载。 1容器是将镜像运行在一个容器中 Registry 123用户可以在自己的数据中心搭建私有的re">
    
        <link rel="alternate" type="application/atom+xml" title="Yo42" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');</script></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/yo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Yo</h5>
          <a href="mailto:edyo7024@gmail.com" title="edyo7024@gmail.com" class="mail">edyo7024@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags">
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://yo42.github.io/Aobut-Me/">
                <i class="icon icon-lg icon-user"></i>
                About Me
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Docker 学习笔记</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Docker 学习笔记</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-09T09:52:13.149Z" itemprop="datePublished" class="page-time">
  2018-09-09
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Technology/">Technology</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#删除Docker镜像"><span class="post-toc-number">1.</span> <span class="post-toc-text">删除Docker镜像</span></a></li></ol><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在Docker构建nginx容器-在构建Dockerfile时应在空目录下构建"><span class="post-toc-number"></span> <span class="post-toc-text">在Docker构建nginx容器 #在构建Dockerfile时应在空目录下构建</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#构建dockerfile"><span class="post-toc-number">1.</span> <span class="post-toc-text">构建dockerfile</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#进入容器修改配置文件"><span class="post-toc-number">2.</span> <span class="post-toc-text">进入容器修改配置文件:</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#制作成镜像commit"><span class="post-toc-number">3.</span> <span class="post-toc-text">制作成镜像commit:</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#构建Nginx的主目录和日志目录"><span class="post-toc-number">4.</span> <span class="post-toc-text">构建Nginx的主目录和日志目录:</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#正式运行下载环境的容器：需要映射端口，公网访问"><span class="post-toc-number">5.</span> <span class="post-toc-text">正式运行下载环境的容器：需要映射端口，公网访问</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#从容器内拷贝文件到主机上"><span class="post-toc-number"></span> <span class="post-toc-text">从容器内拷贝文件到主机上</span></a>
        </li></nav>
    </aside>


<article id="post-Docker-学习笔记" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Docker 学习笔记</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-09 17:52:13" datetime="2018-09-09T09:52:13.149Z" itemprop="datePublished">2018-09-09</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Technology/">Technology</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>Docker有两个概念需要搞清楚,镜像与容器。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">镜像是从网上docker pub上拉取下来的镜像，拉取下来后可以使用docker run命令进行运行。</span><br><span class="line"># dockerhub 是官方构建的一个镜像仓库,类似github一样,上面累积了许多人上传制作的镜像,有官方,有的是用户上传的,任何人都可自由下载。</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">容器是将镜像运行在一个容器中</span><br></pre></td></tr></tbody></table></figure>
<p>Registry</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户可以在自己的数据中心搭建私有的registry,也可以从官方使用docker官方的registry也就是docker hub.</span><br><span class="line">它是一个公共的镜像仓库，供用户下载和使用，dockerhub中有两种库。</span><br><span class="line">用户仓库和顶层库，用户仓库是有私人创建的，顶层使用docker公司负责维护的。</span><br></pre></td></tr></tbody></table></figure>
<p>常用操作命令</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">docker images #查看从docker hub上下载到本地的镜像</span><br><span class="line">docker search #镜像名#从docker hub上搜索镜像</span><br><span class="line">docker pull #从docker registry中拉取镜像</span><br><span class="line">docker push #将本地制作好的镜像推送到docker hub</span><br><span class="line">docker rm 容器id #删除容器命令</span><br><span class="line">docker rmi 镜像id #删除镜像 </span><br><span class="line">docker stop $(docker ps -a) #批量停止容器</span><br><span class="line">docker rm $(docker ps -a) # 批量删除容器</span><br><span class="line">docker rm $(docker ps -a|awk '{print $1}'|cut -f 1 -d "C") # 批量删除容器</span><br><span class="line">docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq) #both</span><br><span class="line">###ps:docker rm 与docker rmi 都可以加 -f强制删除,需要注意的是如果删除镜像报错,如果基于镜像启动的容器存在,则无法直接删除,需要先删除容器再删除镜像。</span><br><span class="line">docker inspect # 查看镜像和容器的详细信息</span><br><span class="line">docker ps # 查看容器相关的信息，状态 选项 -a 列出所有容器的的状态 -l 列出最新的状态</span><br><span class="line">docker commit &lt;container_id&gt; &lt;some_name&gt; # 可以将一个容器固化为一个新的镜像,通过commit将镜像保存起来，也就是可以将一个环境配配置好的容器，保存，以后用到在拿出来使用。</span><br><span class="line">docker run -it -v --volumes-from --name --rm --privileged 镜像名字 # 以交互式运行容器 --name 只是一个名称，可以不加 --rm docker容器退出时将自动删除，注意如果容器运行在后台模式是不能带--rm的.需要映射多个端口使用多个-p 选项</span><br><span class="line">docker run 镜像名字 echo “hello world” # 在容器的shell中输出helloworld</span><br><span class="line">docker logs 容器id #显示容器的标准输出</span><br><span class="line">docker attach 容器id #重新进入关闭的容器</span><br><span class="line">docker network inspect bridge</span><br></pre></td></tr></tbody></table></figure>
<p>docker命令结构:</p>
<p>首先有两个方面，一个是docker镜像制作端，一个是用户使用端类似C/S 架构。</p>
<p>使用docker build命令结合dockerfile可以创建管理镜像,创建完后可以push到docker hub。</p>
<p>用户可以通过从网上拉取制作好的镜像,拉取到本地,运行容器。</p>
<p>使用docker pull时,可以从官方docker hub中的官方镜像库,其他公共库,私人仓库,拉取镜像资源,同时也可以拉取私有服务器中获取镜像资源，只需指定特定的库名,或服务器地址即可。</p>
<p>如何临时退出一个正在交互的容器，而不是终止</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">按ctrl-p+ctrl-q   #ctrl -c 是终止停止进程</span><br></pre></td></tr></tbody></table></figure>
<p>构建docker镜像应该遵循的原则,请参考官方文档，dockerfile最佳实践:</p>
<p>尽量选取满足需求但较小的基础系统镜像，例如大部分时候可以选择 debian:wheezy 或 debian:jessie 镜像，仅有不足百兆大小; </p>
<p>清理编译生成文件、安装包的缓存等临时文件; 安装各个软件时候要指定准确的版本号，并避免引入不需要的依赖; </p>
<p>从安全角度考虑，应用要尽量使用系统的库和依赖; 如果安装应用时候需要配置一些特殊的环境变量，</p>
<p>在安装后要还原不需要保持 的变量值; </p>
<p>使用 Dockerfile 创建镜像时候要添加 .dockerignore 文件或使用干净的工作目 录。</p>
<p>在构建docker容器时可以控制容器占用系统资源，调整系统硬件资源，例如cpu，内存，io等。</p>
<p>查看容器映射出来的端口。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -f name=nginx</span><br></pre></td></tr></tbody></table></figure>
<p>查看容器内应用监听的端口：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -ti global_nginx_1 ss -lntp</span><br></pre></td></tr></tbody></table></figure>
<p>制作镜像</p>
<pre><code>两种办法:1.使用Dockerfile,使用docker commit 将容器提交保存为镜像.##最好使用Dockerfile来构建镜像,不推荐docker commit方法。
</code></pre><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">首先编辑一个空白的文本文件命名为DockerfIle，每一个指令的前缀都必须是大写的。</span><br><span class="line">FROM centos    #从centos 这个镜像文件中构建,from字段必须是第一个，可以有多个from</span><br><span class="line">在文件中可以写入运行命令使其在docker容器中运行</span><br><span class="line">RUN echo ’hello world‘ ##在容器中运行的指令</span><br><span class="line">CMD ##</span><br><span class="line">ENV ##后续的指令可以调用变量 ${variable_name}</span><br><span class="line">WORKDIR ##</span><br><span class="line">MAINTAINER ## dockerfile会根据上下文执行的命令，使用缓存，如果修改了使用者名称，将刷新缓存</span><br><span class="line">EXPOSE ## 端口宣告</span><br><span class="line">ADD ##</span><br><span class="line">COPY ##</span><br><span class="line">docker build -t 给镜像一个名称 . #注意，最后有个点，这条命令会读取当前目录下的所有文件以及目录和Dockerfile文件，建议创建新目录来build</span><br><span class="line"></span><br><span class="line">之后使用 docker images 就可以看到自己建立的镜像了，使用docker history 镜像id 就可以查看到刚刚容器的输出结果了。注意这个创建的镜像是不可以开启新的容器的 官方的解释 "Notice the new changed-ubuntu image does not have its own copies of every layer. As can be seen in the diagram below, the new image is sharing its four underlying layers with the ubuntu:15.04 image."</span><br><span class="line">并且使用 docker history 可以看到刚刚通过文件输出镜像的大小只有11b，这种只是个共享图像层。</span><br><span class="line">一旦你构建或创建了一个新的镜像，你可以使用 docker push 命令将镜像推送到 Docker Hub 。这样你就可以分享你的镜像了，镜像可以是公开的，或者你可以把镜像添加到你的私有仓库中。</span><br></pre></td></tr></tbody></table></figure>
<p>Docker Volumes</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">docker volumes 是一个存储卷,它可以使宿主机与容器里面共享数据,这个数据卷可以是系统文件上的任何一个目录,你可以挂在任意个Volumes 到容器里,多个容器也可以共享一个或多个数据量。</span><br><span class="line">docker run --volumes-from </span><br><span class="line">如果你有一些持久化的数据， 并且想在不同的container之间共享这些数据， 或者想在一些没有持久化的container中使用， </span><br><span class="line">最好的方法就是使用 Data Volumn Container, </span><br><span class="line">在把数据mount到你的container里.(译者：如开篇译者提到的docker的container是无状态的， </span><br><span class="line">也就是说标记状态的数据，例如：数据库数据， 应用程序的log 等等， 是不应该放到container里的， 而是放到 Data Volume </span><br><span class="line">Container里, 这点和funcational programming很像， 所以我喜欢把一般的docker container 叫做 </span><br><span class="line">functional container用来区分 data volume container ）</span><br><span class="line">这里的意思相当于有个最简洁的容器来专门跑存储容器，之后的启动的容器都可以使用 docker run --volumes-from 从存储数据容器中来实现数据的共享。</span><br><span class="line">$ docker run -d -v /dbdata --name dbdata training/postgres</span><br><span class="line"> </span><br><span class="line">这样做之后就可以通过 --volumes-from 把 /dbdata mount到其他的container里了</span><br><span class="line"></span><br><span class="line">$ docker run -d --volumes-from dbdata --name db1 training/postgres</span><br><span class="line"> </span><br><span class="line">还可以继续共享到另外一个container里</span><br><span class="line"></span><br><span class="line">$ docker run -d --volumes-from dbdata --name db2 training/postgres</span><br><span class="line"> </span><br><span class="line">-volumes-from 可以多次使用来 mount 多个conatainer里的多个volumes。</span><br><span class="line"></span><br><span class="line">这个操作是链式的， 我们在db1 中通过 --volumes-from mount进来的 volume可以继续被其他container使用</span><br><span class="line"></span><br><span class="line">$ docker run -d --name db3 --volumes-from db1 training/postgres</span><br><span class="line"> </span><br><span class="line">(译者:</span><br><span class="line"> 这里我们不是直接使用 volume container， 而是使用db1 这个functional container 把volume </span><br><span class="line">挂载到另外一个 funcational container上的，所谓的链式就是 dbdata -&gt; db1 -&gt; db3)</span><br><span class="line"></span><br><span class="line">如果你把所有mount volumes的container都移除掉， 包括初始化的那个 dbdata container， volume才会被移除掉。通过这个属性可以方便的升级升级数据或者在不同container间migrate数据.</span><br><span class="line"></span><br><span class="line">备份、恢复和移植数据卷</span><br><span class="line"></span><br><span class="line">Volume的另外一个用处就是备份、恢复和migrate数据。 具体的做法如下，使用 --volumes-from 来创建一个新的container mount这个volume</span><br><span class="line"></span><br><span class="line">$ sudo docker run --volumes-from dbdata -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata</span><br><span class="line"> </span><br><span class="line">&gt;</span><br><span class="line">    这里我们启动了一个新的container， </span><br><span class="line">从 dbdata 挂载了一个volume。同时挂载了一个本地目录到这个container里。最后我们通过一个 tar命令把 dbdata 里的数据备份到了 /backup 里。命令结束并且停止这个container后我们就在本地得到了一个备份的数据.</span><br><span class="line"></span><br><span class="line">(译者: 这里使用的 ubuntu container， 就是为了把volume中的数据打包备份到host的某一个目录里。)</span><br><span class="line"></span><br><span class="line">备份的数据可以恢复到这个container， 或者其他使用这个volume的container。首先创建一个container</span><br><span class="line"></span><br><span class="line">$ sudo docker run -v /dbdata --name dbdata2 ubuntu</span><br><span class="line"> </span><br><span class="line">&gt;    之后un-tar备份文件到 data volume 里</span><br><span class="line"></span><br><span class="line">$ sudo docker run --volumes-from dbdata2 -v $(pwd):/backup busybox tar xvf /backup/backup.tar</span><br><span class="line"> </span><br><span class="line">你可以使用你喜欢的工具加上上面的技术来自动备份，迁移和恢复数据</span><br></pre></td></tr></tbody></table></figure>
<p>实践:在Docker容器中运行web应用</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">首先docker pull nginx 或者制作好web应用的镜像.</span><br><span class="line">docker run -idt -p 80:80 -v /docker/download/:/data/ download:1 #以后台进程运行</span><br><span class="line">docker exec 容器id nginx #使用docker exec执行nginx 启动命令</span><br><span class="line">docker top #查看容器内的进程运行状态</span><br></pre></td></tr></tbody></table></figure>
<p>开启动一个长时间运行的后台进程</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=$(docker run -d centos /bin/bash -c "while true; do echo hello world; sleep 1; done")</span><br><span class="line"></span><br><span class="line">docker logs $a ##将会看到有hello world</span><br></pre></td></tr></tbody></table></figure>
<h4 id="删除Docker镜像"><a href="#删除Docker镜像" class="headerlink" title="删除Docker镜像"></a>删除Docker镜像</h4><p>首先要保证有权限对Docker镜像或者容器进行操作，具体做法参见进入前文安装部分。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 停止所有容器</span><br><span class="line">$ docker stop $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"># 删除指定镜像</span><br><span class="line">$ docker rmi $image</span><br><span class="line"></span><br><span class="line"># 删除无标示镜像，即id为&lt;None&gt;的镜像</span><br><span class="line">$ docker rmi $(docker images | grep "^&lt;none&gt;" | awk "{print $3}")</span><br><span class="line"></span><br><span class="line"># 删除所有镜像</span><br><span class="line">$ docker rmi $(docker images -q)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="在Docker构建nginx容器-在构建Dockerfile时应在空目录下构建"><a href="#在Docker构建nginx容器-在构建Dockerfile时应在空目录下构建" class="headerlink" title="在Docker构建nginx容器 #在构建Dockerfile时应在空目录下构建"></a>在Docker构建nginx容器 #在构建Dockerfile时应在空目录下构建</h3><h4 id="构建dockerfile"><a href="#构建dockerfile" class="headerlink" title="构建dockerfile"></a>构建dockerfile</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat&lt;&lt;\EOF &gt; Dockerfile </span><br><span class="line"># Nginx</span><br><span class="line">#</span><br><span class="line"># Version 1.0</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER djluo &lt;dj.luo@baoyugame.com&gt;</span><br><span class="line">RUN rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br><span class="line">RUN yum -y install nginx; yum clean all</span><br><span class="line">EOF</span><br><span class="line">#通过Dockerfile在容器中安装nginx</span><br><span class="line">docker build -t nginx:1.0 . #-t 只是个版本名称</span><br></pre></td></tr></tbody></table></figure>
<h4 id="进入容器修改配置文件"><a href="#进入容器修改配置文件" class="headerlink" title="进入容器修改配置文件:"></a>进入容器修改配置文件:</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2# </span><br><span class="line">bash-4.2# rm conf.d/{default.conf,example_ssl.conf}</span><br><span class="line">bash-4.2# rm -f /etc/nginx/{koi-utf,koi-win,scgi_params,uwsgi_params,win-utf}</span><br><span class="line">bash-4.2# cat&lt;&lt;\EOF &gt; /etc/nginx/conf.d/download.conf </span><br><span class="line">server {</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root       /data/html;</span><br><span class="line">    access_log /data/logs/download.log;</span><br><span class="line">    location / {</span><br><span class="line">        autoindex on;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">bash-4.2# mkdir -p /data/{html,logs}</span><br><span class="line">bash-4.2# /usr/sbin/nginx -t </span><br><span class="line">bash-4.2# exit</span><br></pre></td></tr></tbody></table></figure>
<h4 id="制作成镜像commit"><a href="#制作成镜像commit" class="headerlink" title="制作成镜像commit:"></a>制作成镜像commit:</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps -l # 获取最新的一个容器信息，通常就是上面操作的了。</span><br><span class="line">docker commit -a "djluo &lt;dj.luo@baoyugame.com&gt;" -m "用于docker build的下载环境" 07d7a871cf32 download:1</span><br><span class="line">docker rm 07d7a871cf32 # 删除容器</span><br></pre></td></tr></tbody></table></figure>
<h4 id="构建Nginx的主目录和日志目录"><a href="#构建Nginx的主目录和日志目录" class="headerlink" title="构建Nginx的主目录和日志目录:"></a>构建Nginx的主目录和日志目录:</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/docker/download/{html,logs}</span><br><span class="line">echo "Hi" &gt; ~/docker/download/html/index.html</span><br></pre></td></tr></tbody></table></figure>
<h4 id="正式运行下载环境的容器：需要映射端口，公网访问"><a href="#正式运行下载环境的容器：需要映射端口，公网访问" class="headerlink" title="正式运行下载环境的容器：需要映射端口，公网访问"></a>正式运行下载环境的容器：需要映射端口，公网访问</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 --name download -v /docker/download/:/data/ download:1 /usr/sbin/nginx</span><br><span class="line">#将docker容器里的80端口映射到宿主机的80，好让外网访问，-v共享存储卷，将宿主机的目录数据挂载到容器里  并且启动nginx</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">正确的用法：应该是分为2个容器，应用容器和管理容器。</span><br><span class="line">应用容器：跑具体的应用，如nginx、java、php等。将应用数据放到VOULME中。</span><br><span class="line">管理容器：跑SSHD，并挂载上应用容器的数据VOULME。随心所欲的操作吧。</span><br><span class="line">不过有些应用的重启、重新导入配置等，可能需要到容器外操作</span><br><span class="line">docker守护进进程(服务端)默认以unixsocket方式启动，如果需要用到远程调用需要使用remoteapi</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">以下是一个RUN格式正确的指导，显示所有apt-get 建议。</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y \</span><br><span class="line">    aufs-tools \</span><br><span class="line">    automake \</span><br><span class="line">    build-essential \</span><br><span class="line">    curl \</span><br><span class="line">    dpkg-sig \</span><br><span class="line">    libcap-dev \</span><br><span class="line">    libsqlite3-dev \</span><br><span class="line">    mercurial \</span><br><span class="line">    reprepro \</span><br><span class="line">    ruby1.9.1 \</span><br><span class="line">    ruby1.9.1-dev \</span><br><span class="line">    s3cmd=1.1.* \</span><br><span class="line"> &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">####################ENTRYPOINT###############################</span><br><span class="line">ENTRYPOINT ["executable", "param1", "param2"] （exec表格，首选）</span><br></pre></td></tr></tbody></table></figure>
<p>docker 默认本地的仓库目录，存储着push的镜像。</p>
<p>这个目录默认是100g，超过了将会push失败，所以建议定时清理。</p>
<h3 id="从容器内拷贝文件到主机上"><a href="#从容器内拷贝文件到主机上" class="headerlink" title="从容器内拷贝文件到主机上"></a>从容器内拷贝文件到主机上</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp &lt;containerId&gt;:/file/path/within/container /host/path/target</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker 镜像导入和导出</span><br><span class="line">导出镜像</span><br><span class="line">docker save -o centos7.tar centos</span><br><span class="line">导入本地镜像</span><br><span class="line">sudo docker load --input centos7.tar</span><br></pre></td></tr></tbody></table></figure>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-09-09T10:03:45.823Z" itemprop="dateUpdated">2018-09-09 18:03:45</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://yo42.github.io">
            <img src="/img/yo.jpg" alt="Yo">
            Yo
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Technology/">Technology</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yo42.github.io/2018/09/09/Docker-学习笔记/&amp;title=《Docker 学习笔记》 — Yo42&amp;pic=https://yo42.github.io/img/yo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yo42.github.io/2018/09/09/Docker-学习笔记/&amp;title=《Docker 学习笔记》 — Yo42&amp;source=aaa" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yo42.github.io/2018/09/09/Docker-学习笔记/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Docker 学习笔记》 — Yo42&amp;url=https://yo42.github.io/2018/09/09/Docker-学习笔记/&amp;via=https://yo42.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yo42.github.io/2018/09/09/Docker-学习笔记/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/09/11/Docker-远程API调用启用TLS加密/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Docker 远程API调用启用TLS加密</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/09/09/你的-Python-开发者环境/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">我的 Python 开发环境</h4>
      </a>
    </div>
  
</nav>



    

















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Yo © 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> 
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yo42.github.io/2018/09/09/Docker-学习笔记/&amp;title=《Docker 学习笔记》 — Yo42&amp;pic=https://yo42.github.io/img/yo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yo42.github.io/2018/09/09/Docker-学习笔记/&amp;title=《Docker 学习笔记》 — Yo42&amp;source=aaa" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yo42.github.io/2018/09/09/Docker-学习笔记/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Docker 学习笔记》 — Yo42&amp;url=https://yo42.github.io/2018/09/09/Docker-学习笔记/&amp;via=https://yo42.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yo42.github.io/2018/09/09/Docker-学习笔记/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://yo42.github.io/2018/09/09/Docker-学习笔记/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>




<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>














<script type="text/javascript" src="/bundle.js"></script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>
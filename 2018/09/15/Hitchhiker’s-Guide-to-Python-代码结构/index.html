<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Hitchhiker&#39;s Guide to Python-代码结构 | Neo42 | Dont&#39;t Panic,Do not go gentle into that good night :)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Technology">
    <meta name="description" content="这里我们所说的「结构」就是关于如何让项目达到预期的目标。我们需要考虑的是如何更好的利用 Python 的特性创造出干净、有效的代码。实际上，「结构」意味着代码的结构、依赖非常的清晰，像文件系统中的文件和文件夹一样。 哪些函数应该放在哪个模块中？项目中的数据流是怎样的？哪些函数应该组织在一起或者分离开？从广义上讲，通过回答这些问题，你就可以开始规划你的项目长什么样子。 在本节中，我们将深入研究 Py">
<meta name="keywords" content="Technology">
<meta property="og:type" content="article">
<meta property="og:title" content="Hitchhiker&#39;s Guide to Python-代码结构">
<meta property="og:url" content="https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/index.html">
<meta property="og:site_name" content="Neo42">
<meta property="og:description" content="这里我们所说的「结构」就是关于如何让项目达到预期的目标。我们需要考虑的是如何更好的利用 Python 的特性创造出干净、有效的代码。实际上，「结构」意味着代码的结构、依赖非常的清晰，像文件系统中的文件和文件夹一样。 哪些函数应该放在哪个模块中？项目中的数据流是怎样的？哪些函数应该组织在一起或者分离开？从广义上讲，通过回答这些问题，你就可以开始规划你的项目长什么样子。 在本节中，我们将深入研究 Py">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-09-15T09:43:00.539Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hitchhiker&#39;s Guide to Python-代码结构">
<meta name="twitter:description" content="这里我们所说的「结构」就是关于如何让项目达到预期的目标。我们需要考虑的是如何更好的利用 Python 的特性创造出干净、有效的代码。实际上，「结构」意味着代码的结构、依赖非常的清晰，像文件系统中的文件和文件夹一样。 哪些函数应该放在哪个模块中？项目中的数据流是怎样的？哪些函数应该组织在一起或者分离开？从广义上讲，通过回答这些问题，你就可以开始规划你的项目长什么样子。 在本节中，我们将深入研究 Py">
    
        <link rel="alternate" type="application/atom+xml" title="Neo42" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/yo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Neo</h5>
          <a href="mailto:edyo7024@gmail.com" title="edyo7024@gmail.com" class="mail">edyo7024@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Hitchhiker&#39;s Guide to Python-代码结构</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Hitchhiker&#39;s Guide to Python-代码结构</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-15T04:28:12.303Z" itemprop="datePublished" class="page-time">
  2018-09-15
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Technology/">Technology</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#仓库结构"><span class="post-toc-number">1.</span> <span class="post-toc-text">仓库结构</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#That-is-important"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">That is important!</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简单的仓库"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">简单的仓库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#具体模块"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">具体模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#授权"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">授权</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Setup-py"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">Setup.py</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#依赖文件"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">依赖文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文档"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">文档</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#测试套件"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">测试套件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Makefile"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">Makefile</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#关于-Django-应用程序"><span class="post-toc-number">1.10.</span> <span class="post-toc-text">关于 Django 应用程序</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码结构是关键"><span class="post-toc-number">2.</span> <span class="post-toc-text">代码结构是关键</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模块"><span class="post-toc-number">3.</span> <span class="post-toc-text">模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#包系统"><span class="post-toc-number">4.</span> <span class="post-toc-text">包系统</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#面向对象编程"><span class="post-toc-number">5.</span> <span class="post-toc-text">面向对象编程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#装饰器"><span class="post-toc-number">6.</span> <span class="post-toc-text">装饰器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#上下文管理器"><span class="post-toc-number">7.</span> <span class="post-toc-text">上下文管理器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#动态类型"><span class="post-toc-number">8.</span> <span class="post-toc-text">动态类型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#可变和不可变类型"><span class="post-toc-number">9.</span> <span class="post-toc-text">可变和不可变类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#注意"><span class="post-toc-number">9.0.1.</span> <span class="post-toc-text">注意</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">10.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Hitchhiker’s-Guide-to-Python-代码结构"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Hitchhiker's Guide to Python-代码结构</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-15 12:28:12" datetime="2018-09-15T04:28:12.303Z"  itemprop="datePublished">2018-09-15</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Technology/">Technology</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>这里我们所说的「结构」就是关于如何让项目达到预期的目标。我们需要考虑的是如何更好的利用 Python 的特性创造出干净、有效的代码。实际上，「结构」意味着代码的结构、依赖非常的清晰，像文件系统中的文件和文件夹一样。</p>
<p>哪些函数应该放在哪个模块中？项目中的数据流是怎样的？哪些函数应该组织在一起或者分离开？从广义上讲，通过回答这些问题，你就可以开始规划你的项目长什么样子。</p>
<p>在本节中，我们将深入研究 Python 的模块和导入系统，因为它们是项目结构中的核心元素。然后我们将探讨如何构建可扩展易测试的代码结构的各种观点。</p>
<h2 id="仓库结构"><a href="#仓库结构" class="headerlink" title="仓库结构"></a>仓库结构</h2><h3 id="That-is-important"><a href="#That-is-important" class="headerlink" title="That is important!"></a>That is important!</h3><p>就像代码风格，API 设计和自动化对于健康的开发周期是必不可少的，仓库结构也是项目<a href="http://www.amazon.com/gp/product/1257638017/ref=as_li_ss_tl?ie=UTF8&amp;tag=bookforkind-20&amp;linkCode=as2&amp;camp=1789&amp;creative=39095&amp;creativeASIN=1257638017" target="_blank" rel="noopener">体系结构</a>中的重要组成部分。</p>
<p>当一个潜在用户或贡献者打开你的仓库页面，他们将看到：</p>
<ul>
<li>项目名称</li>
<li>项目描述</li>
<li>大堆的文件</li>
</ul>
<p>只有当他们在下滑滚动时，才能看到项目里的自述文档。</p>
<p>如果你的仓库包含了大量的垃圾文件或者混乱嵌套的目录结构，即使有漂亮的自述文档，用户也可能尚未看到就前往查看其他项目了。</p>
<blockquote>
<p>为你想要的工作而装扮，而不是你现在做的工作而装扮。</p>
</blockquote>
<p>当然，第一印象并不代表全部。你和你的同事可能花费数个小时在这个仓库中，最终对每个细节都非常熟悉。它的布局很重要。</p>
<h3 id="简单的仓库"><a href="#简单的仓库" class="headerlink" title="简单的仓库"></a>简单的仓库</h3><p><strong>简述</strong>: 这个仓库是  <a href="http://kennethreitz.org/" target="_blank" rel="noopener">Kenneth Reitz</a>  的建议。</p>
<p>可以在 <a href="https://github.com/kennethreitz/samplemod" target="_blank" rel="noopener">GitHub</a> 上看到。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">README.rst</span><br><span class="line">LICENSE</span><br><span class="line">setup.py</span><br><span class="line">requirements.txt</span><br><span class="line">sample/__init__.py</span><br><span class="line">sample/core.py</span><br><span class="line">sample/helpers.py</span><br><span class="line">docs/conf.py</span><br><span class="line">docs/index.rst</span><br><span class="line">tests/test_basic.py</span><br><span class="line">tests/test_advanced.py</span><br></pre></td></tr></table></figure>
<p>让我们深入了解一些细节。</p>
<h3 id="具体模块"><a href="#具体模块" class="headerlink" title="具体模块"></a>具体模块</h3><table>
<thead>
<tr>
<th>位置</th>
<th><code>./sample/</code> 或 <code>./sample.py</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>具体代码</td>
</tr>
</tbody>
</table>
<p>模块包是仓库的核心。它不应该被藏起来：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sample/</span><br></pre></td></tr></table></figure>
<p>如果你的模块内只有一个文件，你可以直接把这个文件放在仓库的根目录下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sample.py</span><br></pre></td></tr></table></figure>
<p>你的模块不应属于一个模糊的 src 目录或 python 的子目录。</p>
<h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><table>
<thead>
<tr>
<th>位置</th>
<th><code>./LICENSE</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>法律相关</td>
</tr>
</tbody>
</table>
<p>除了源码本身外，这可以说是仓库中最重要的部分。在这个文件中应该包含完整的许可证文本和版权声明。</p>
<p>如果你不确定项目中应该使用哪种授权，请参考 <a href="http://choosealicense.com/" target="_blank" rel="noopener">choosealicense.com</a> 。</p>
<p>当然，你也可以发布不包含授权的代码，但这可能会让很多人不去使用你的代码。</p>
<h3 id="Setup-py"><a href="#Setup-py" class="headerlink" title="Setup.py"></a>Setup.py</h3><table>
<thead>
<tr>
<th>位置</th>
<th><code>./setup.py</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>包安装和分发管理</td>
</tr>
</tbody>
</table>
<p>如果你的模块包在仓库的根目录下，这个文件也应该位于根目录。</p>
<h3 id="依赖文件"><a href="#依赖文件" class="headerlink" title="依赖文件"></a>依赖文件</h3><table>
<thead>
<tr>
<th>位置</th>
<th><code>./requirements.txt</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>开发中的依赖</td>
</tr>
</tbody>
</table>
<p> <a href="https://pip.pypa.io/en/stable/user_guide/#requirements-files" target="_blank" rel="noopener">pip requirements file</a>  应该放置在仓库的根目录下。它应指出项目所需的依赖关系，包括测试、构建和生成文档过程中的。</p>
<p>如果该项目开发不需要依赖，或者你喜欢通过  <code>setup.py</code> 安装开发环境，这个文件可能不是必须的。</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><table>
<thead>
<tr>
<th>位置</th>
<th><code>./docs/</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>项目的参考文档</td>
</tr>
</tbody>
</table>
<p>没有理由把它放在其他地方。</p>
<h3 id="测试套件"><a href="#测试套件" class="headerlink" title="测试套件"></a>测试套件</h3><p><em>有关编写测试的建议，请参考</em>  <a href="http://docs.python-guide.org/en/latest/writing/tests/" target="_blank" rel="noopener"><em>Testing Your Code</em></a> 。</p>
<table>
<thead>
<tr>
<th>位置</th>
<th><code>./test_sample.py</code> 或 <code>./tests</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>软件包集成和单元测试</td>
</tr>
</tbody>
</table>
<p>开始时，一个小的测试套件经常在一个文件中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test_sample.py</span><br></pre></td></tr></table></figure>
<p>一旦测试套件多起来时，可以像这样把各套件放在一个文件夹中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tests/test_basic.py</span><br><span class="line">tests/test_advanced.py</span><br></pre></td></tr></table></figure>
<p>显然，这些测试套件需要你导入包模块才能运行测试。你可以通过这些方法来做：</p>
<ul>
<li>将包安装在 site-packages 中。</li>
<li>使用一个简单（但是<em>明确</em>）的路径去修正解决它。</li>
</ul>
<p>我强烈推荐后者。需要开发者在修改代码后主动运行 <code>setup.py develop</code> 去测试，也需要为每个代码库实例设置独立的运行环境。</p>
<p>要给单个测试导入上下文，请创建一个 tests/context.py 文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">sys.path.insert(<span class="number">0</span>, os.path.abspath(os.path.join(os.path.dirname(<span class="keyword">__file__</span>), <span class="string">'..'</span>)))</span><br><span class="line"></span><br><span class="line">import sample</span><br></pre></td></tr></table></figure>
<p>然后，在各个测试模块中导入这个上下文模块：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from .context import sample</span><br></pre></td></tr></table></figure>
<p>无论安装方式如何，这通常都会像预期那样工作。</p>
<p>有的人会建议你应该把测试放在你自己的代码模块内，我不同意这个观点。这通常会增加用户的复杂性，而且许多的测试套件往往需要额外的依赖和运行时上下文。</p>
<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><table>
<thead>
<tr>
<th>位置</th>
<th><code>./Makefile</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>通用的管理任务。</td>
</tr>
</tbody>
</table>
<p>如果你看过我的大部分项目或任何 Pocoo 项目，你都会注意到有一个 Makefile 文件。 为什么？ 这些项目不是用 C 语言编写的… 简而言之， make 是一个定义项目通用任务的非常有用的工具。</p>
<p><strong>一个简单的 Makefile：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">init:</span><br><span class="line">    pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">    py.test tests</span><br><span class="line"></span><br><span class="line">.PHONY: init test</span><br></pre></td></tr></table></figure>
<p>其他通用的管理脚本（例如 <code>manage.py</code> 或 <code>fabfile.py</code> ）也应放在仓库的根目录。</p>
<h3 id="关于-Django-应用程序"><a href="#关于-Django-应用程序" class="headerlink" title="关于 Django 应用程序"></a>关于 Django 应用程序</h3><p>自从 Django 1.4发布以来，我注意到了 Django 应用程序的一个新趋势。 由于新的捆绑应用程序模板，许多开发人员构建其仓库的效果很差。</p>
<p>怎样做的呢？他们总是在一个新的仓库中运行以下内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ django-admin.py startproject samplesite</span><br></pre></td></tr></table></figure>
<p>这样生成的仓库结构如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">README.rst</span><br><span class="line">samplesite/manage.py</span><br><span class="line">samplesite/samplesite/settings.py</span><br><span class="line">samplesite/samplesite/wsgi.py</span><br><span class="line">samplesite/samplesite/sampleapp/models.py</span><br></pre></td></tr></table></figure>
<p>不要这样做。</p>
<p>重复的路径会让你的工具和开发人员感到困惑。不必要的嵌套对任何人都没有帮助（除非他们怀念单一的 SVN 仓库）。</p>
<p>让我们正确的做到这一点：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ django-admin.py startproject samplesite .</span><br></pre></td></tr></table></figure>
<p>注意那个 <code>.</code> 。</p>
<p>由此生成的仓库结构如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">README.rst</span><br><span class="line">manage.py</span><br><span class="line">samplesite/settings.py</span><br><span class="line">samplesite/wsgi.py</span><br><span class="line">samplesite/sampleapp/models.py</span><br></pre></td></tr></table></figure>
<h2 id="代码结构是关键"><a href="#代码结构是关键" class="headerlink" title="代码结构是关键"></a>代码结构是关键</h2><p>Python 处理了导入和模块，因此构建 Python 项目相对容易。容易是指没有太多的约束，并且模块导入模型很容易掌握。因此，您所剩的是纯架构方面的任务，比如设计项目的不同点及其交互。</p>
<p>一个项目的结构简单意味着它也很容易做得不好。结构不佳的项目包括以下一些特征：</p>
<ul>
<li>多个杂乱的循环依赖关系：假如 <code>furn.py</code> 中 Table (桌子) 和 Chair （椅子）类需要从 <code>workers.py</code> 导入 Carpenter （木匠） 来回答诸如 <code>table.isdoneby()</code> 的问题；相反地，假如 Carpenter 类需要导入 Table 和 Chair 来回答诸如 <code>carpenter.whatdo()</code> 的问题。这样，就产生了一个循环依赖关系。在这种情况下，你不得不凭借脆弱的技巧，例如在方法或函数内使用导入语句。</li>
<li>隐藏的耦合关系： Table 实现中的每一次更改会在不相关的测试用例中中断20次测试，因为它破坏了 Carpenter 的代码，需要非常仔细的处理来适应此次更改。这意味着在 Carpenter 中有较多关于 Table 的假设，或在 Table 中有较多关于 Carpenter 的假设。</li>
<li>对全局状态或上下文的大量使用： Table 和 Carpenter 依赖于可修改的全局变量（可由不同的代理进行修改），而不是显式传递 <code>(高度、宽度、类型、木材)</code> 。你需要检查对这些全局变量的所有访问，以了解为什么长方形桌子变成了正方形，然后发现远程模板代码也在修改此上下文，从而弄乱了桌子的尺寸。</li>
<li>“意大利面条”式代码: 代码有多页嵌套 if 子句、 for 循环，有大量的复制粘贴程序代码，并没有适当的分块称为“意大利面条”式代码。 Python 的有意义的缩进 (最具争议性的特征之一) 使得维护这种代码变得非常困难。好消息是你可能看不到太多这种情况。</li>
<li>在 Python 中更有可能看到的是“意大利饺子”式代码：它由数百个类似的小逻辑片段组成，通常是类或对象，没有适当的结构。如果你不记得是否应该使用 FurnitureTable 、 AssetTable ，还是 TableNew 来完成手头上的任务，那么你可能会在“意大利饺子”式代码中漫无目的地游着。</li>
</ul>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>Python 模块是可用的主要抽象层之一，也是最自然的一个。抽象层允许将代码分成包含相关数据和功能的多个部分。</p>
<p>例如，项目的一层可以处理用户操作的接口，而另一层可以处理数据的底层操作。将这两层分离最自然的方法是：将所有接口功能组合在一个文件中，而在另一个文件中组合数据底层操作。在这种情况下，接口文件需要导入数据底层操作文件，这是通过 <code>import</code> 和 <code>from... import</code> 语句完成的。</p>
<p>一旦使用 <em>import</em> 语句，就会使用模块。这些模块可以是内置的模块，如 <em>os</em> 和 <em>sys</em>、环境中安装的第三方模块，或项目中的内部模块。</p>
<p>要与样式指南保持一致，需保持模块名称简短、小写，并确保避免使用特殊符号，如点（.）或问号（？）。所以应该避免像 <code>my.spam.py</code> 这样的文件名！以这种方式命名会影响 Python 查找模块的方式。</p>
<p>在这个 <em>my.spam.py</em> 情况下， Python 希望在名为 <code>my</code> 的文件夹中找到一个 <code>spam.py</code> 文件，但不应该这样命名。在 Python 文档中有一个应该如何使用点表示法的 <a href="http://docs.python.org/tutorial/modules.html#packages" target="_blank" rel="noopener">例子</a> 。</p>
<p>如果你希望将模块命名为 <code>my_spam.py</code> ，但其实下划线也不应该在模块名称中经常出现。在模块名称中使用其他字符（空格或连字符）将会阻止导入（- 是减操作符），因此请尽量保持模块名称的简短，这样就不需要将单词分开了。而且，最重要的是，不要使用带下划线的名称空间，应该使用子模块。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以</span></span><br><span class="line">import library.plugin.foo</span><br><span class="line"><span class="comment"># 不行</span></span><br><span class="line">import library.foo_plugin</span><br></pre></td></tr></table></figure>
<p>除了一些命名限制之外， Python 文件并不是一个特殊的模块，但你需要了解导入机制才能正确使用这个概念并避免一些问题。</p>
<p>具体地说， <code>import modu</code> 语句会去查找正确的文件，首先会在调用者所在的目录中查找 <code>modu.py</code> 。如果找不到，Python 解释器将递归搜索 “path” 中的 <code>modu.py</code> 。如果未找到，则引发 ImportError 异常。</p>
<p>一旦找到 <code>modu.py</code> ，Python 解释器将在一个隔离的空间内执行该模块。 <code>modu.py</code> 中的任何顶级语句都将被执行，包括其他导入（如果有的话）。 函数和类的定义存储在模块的字典中。</p>
<p>然后，模块的变量，函数和类将通过模块的名称空间提供给调用者，这是编程中的一个核心理念，在 Python 中特别有用而且功能强大。</p>
<p>在许多语言中，预处理器使用 <code>include file</code> 指令来获取文件中的所有代码，并将其复制到调用者的代码中。 这在 Python 中有所不同：导入的代码会被隔离在模块的命名空间内，这意味着你通常不必担心导入代码可能会产生不需要的效果，例如导入模块中有用相同的名称不会覆盖已有的函数。</p>
<p>通过使用 import 语句的特殊语法可以模拟更标准的行为：<code>from modu import *</code>。 这通常被认为是不好的做法。 <strong>使用</strong> <code>import *</code> <strong>会使代码更难阅读，并使得依赖更少的分块</strong>。</p>
<p>使用 <code>from modu import func</code> 是一种精确定位您想要导入的函数并将其放入全局命名空间的方法。 它比 <code>import *</code> 危害更小，因为它显式地显示了在全局命名空间中要导入的内容，它比简单的 <code>import modu</code> 的唯一优点是它可以节省一些输入。</p>
<p><strong>非常槽糕</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">from modu import *</span><br><span class="line">[...]</span><br><span class="line">x = sqrt(<span class="number">4</span>)  <span class="comment">#  sqrt是modu的一部分吗? 内置的? 上面定义了?</span></span><br></pre></td></tr></table></figure>
<p><strong>好一点的</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from modu import sqrt</span><br><span class="line">[...]</span><br><span class="line">x = sqrt(<span class="number">4</span>)  <span class="comment"># sqrt 可能是modu的一部分, 如果不在之间重新定义的话</span></span><br></pre></td></tr></table></figure>
<p><strong>最佳</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import modu</span><br><span class="line">[...]</span><br><span class="line">x = modu.sqrt(<span class="number">4</span>)  <span class="comment"># sqrt显然是modu的命名空间的一部分</span></span><br></pre></td></tr></table></figure>
<p>如 <a href="http://docs.python-guide.org/en/latest/writing/style/#code-style" target="_blank" rel="noopener">Code Style</a> 部分所述, 可读性是 Python 的主要特性之一。可读性意味着避免无用的样板文字和混乱，因此有必要花费一些努力来达到一定程度的简洁性上。但简洁不是简短和晦涩难懂。如 <code>modu.func</code> 的习惯用法，就能够立即判断类或函数来自何处。 除了最简单的单个文件项目之外，这样写可以大大提高了代码的可读性和可理解性。</p>
<h2 id="包系统"><a href="#包系统" class="headerlink" title="包系统"></a>包系统</h2><p>Python 提供了一个非常简单的封装系统，它只是模块机制到目录的扩展。</p>
<p>任何一个带有 <code>__init__.py</code> 文件的目录都被认为是 Python 包。包中的不同模块以类似于普通模块的方式导入，但 <code>__init__.py</code> 文件具有特殊的行为，该文件用于收集所有包范围的定义。</p>
<p>一个在目录 <code>pack/</code> 中的 <code>modu.py</code> 文件通过语句 <code>import pack.modu</code> 来导入。这个语句将在 <code>pack</code> 目录中查找 <code>__init__.py</code> 文件，并执行其所有顶级语句。接着它将查找一个叫 <code>pack/modu.py</code> 的文件并执行其所有顶级语句。在这些操作时候定义在 <code>modu.py</code> 中的任何变量，函数或类都在 pack.modu 命名空间中可用。</p>
<p>一个常见的问题是添加太多的代码到 <code>__init__.py</code> 文件中。当项目的复杂度增长时，在深层目录结构中可能由子包和子子包。在这种情况下，从子子包中导入单个项时遍历目录树时将需要执行所有 <code>__init__.py</code> 文件。</p>
<p>如果一个包的模块和子包不需要共享任何代码，那么让 <code>__init__.py</code> 文件保持为空是正常的，甚至是一个好的实践。</p>
<p>最后，一个简便的语法可以用来导入深度嵌套的包：<code>import very.deep.module as mod</code> 这允许你使用 <em>mod</em> 来代替冗长罗嗦的 <code>very.deep.module</code>。</p>
<h2 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h2><p>Python 有时被描述为一种面向对象的编程语言。这可能对大家有些误导，需要加以澄清。</p>
<p>在 Python 中，所有东西都视为一个对象，并且可以按对象处理。当我们说，函数是“一级”对象，就是将函数视为对象的意思。函数、类、字符串，甚至类型都是 Python 中的对象：像任何对象一样，它们有一个类型，可以作为函数参数传递，并且它们可能有方法和属性。按这种理解， Python 是一种面向对象的语言。</p>
<p>但是，与 Java 不同， Python 并没有将面向对象的编程作为主要的编程范例来实施。 Python 项目不采用面向对象的方式是完全可行的，即不使用或很少使用类定义、类继承或特定于面向对象编程的任何其他机制。</p>
<p>此外，从 <a href="http://docs.python-guide.org/en/latest/writing/structure/#modules" target="_blank" rel="noopener">模块</a> 部分可以看出， Python 处理模块和名称空间的方式为开发人员提供了一种自然的方法来确保抽象层的封装和分离，这两者都是使用面向对象的最常见原因。因此，当业务模型不需要面向对象时， Python 程序员有更大的自由来不使用面向对象编程。</p>
<p>基于一些因素的考虑，我们应避免不必要的面向对象编程。当我们想将一些状态和功能粘合在一起时，定义自定义类是很有用的。在函数编程的讨论中，我们指出，“不必要的面向对象编程”这个问题出自方程的“状态”部分。</p>
<p>在某些体系结构中，例如典型的 web 应用程序，会生成多个 Python 进程实例，以响应可能同时发生的外部请求。在这种情况下，将一些状态保存到实例对象中，意味着保留一些关于世界的静态信息，这很容易出现并发或竞争问题。有时，在对象的初始化（通常用 <code>__init__()</code> 方法来完成）状态和实际使用对象方法的状态之间，世界信息可能已经改变，保持的状态可能已经过时。例如，一个请求加载了内存中的某一项，并将其标记为由用户读取。而另一个请求同时要求删除该项，这可能发生在第一个进程加载该项之后，然后我们必须将其标记为已删除对象。</p>
<p>上述以及其他问题引出了这样的想法：使用无状态函数是一种更好的编程范例。</p>
<p>另一种说法是建议尽可能少的使用具有隐式上下文和副作用的函数和程序。函数的隐式上下文由全局变量和持久层中的数据项（使用方法访问）组成。副作用是指函数对其隐式上下文所做的更改。如果函数会保存或删除全局变量或持久层中的数据，则称它有副作用。</p>
<p>将有上下文和副作用的函数与逻辑函数（称为纯函数）隔离开来，可以获得以下好处：</p>
<ul>
<li>纯函数是确定性的：给定一个固定的输入，输出始终是相同的。</li>
<li>纯函数需要重构或优化时，更容易更改或替换。</li>
<li>纯函数更易于使用单元测试进行测试：对于复杂的上下文设置和事后的数据清理的需求更少。</li>
<li>纯函数更容易操作、修饰和传递。</li>
</ul>
<p>总之，针对某些体系结构，由于没有上下文或副作用，纯函数是比类和对象更有效的构建块。</p>
<p>显然，面向对象编程在许多情况下是有用的，甚至是必要的，例如在开发图形化桌面应用程序或游戏时，被操作的东西（窗口、按钮、化身、车辆）在计算机内存中具有相对较长的寿命。</p>
<h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>Python 语言提供了一种简单而强大的语法，称为“装饰器”。装饰器是一个函数或类，它包装（或装饰）了函数或方法。装饰器函数或方法将替换原来“未装饰”的函数或方法。因为函数是 Python 中的一级对象，所以可以“手动”完成（参见下述示例），但是使用 @decorator 语法则更清晰，也更受青睐。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def foo():</span><br><span class="line">    <span class="comment"># 一些操作</span></span><br><span class="line"></span><br><span class="line">def decorator(func):</span><br><span class="line">    <span class="comment"># 处理 func</span></span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">foo = decorator(foo)  <span class="comment"># 手动装饰</span></span><br><span class="line"></span><br><span class="line">@decorator</span><br><span class="line">def bar():</span><br><span class="line">    <span class="comment"># 一些操作</span></span><br><span class="line"><span class="comment"># bar() 被装饰了</span></span><br></pre></td></tr></table></figure>
<p>此机制对于分离关注点和避免外部非相关逻辑“污染”函数或方法的核心逻辑很有用。最好采用装饰器来处理的一个功能示例是 <a href="https://en.wikipedia.org/wiki/Memoization#Overview" target="_blank" rel="noopener">备注</a> 或缓存：你希望将计算非常耗时/耗空间的函数的结果存储在表中，并直接使用这些结果，而不是在已经计算过以后重新调用并计算。这显然不是函数逻辑的一部分。</p>
<h2 id="上下文管理器"><a href="#上下文管理器" class="headerlink" title="上下文管理器"></a>上下文管理器</h2><p>上下文管理器是一个 Python 对象，为操作提供了额外的上下文信息。 这种额外的信息， 在使用 <code>with</code> 语句初始化上下文，以及完成 <code>with</code> 块中的所有代码时，采用可调用的形式。 这里展示了使用上下文管理器的为人熟知的示例，打开文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(<span class="string">'file.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    contents = f.read()</span><br></pre></td></tr></table></figure>
<p>任何熟悉这种模式的人都知道以这种形式调用 <code>open</code> 能确保 <code>f</code> 的 <code>close</code> 方法会在某个时候被调用。 这样可以减少开发人员的认知负担，并使代码更容易阅读。</p>
<p>实现这个功能有两种简单的方法：使用类或使用生成器。 让我们自己实现上面的功能，以使用类方式开始：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class CustomOpen(object):</span><br><span class="line">    def __init__(<span class="keyword">self</span>, filename):</span><br><span class="line">        <span class="keyword">self</span>.file = open(filename)</span><br><span class="line"></span><br><span class="line">    def __enter__(<span class="keyword">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.file</span><br><span class="line"></span><br><span class="line">    def __exit__(<span class="keyword">self</span>, ctx_type, ctx_value, ctx_traceback):</span><br><span class="line">        <span class="keyword">self</span>.file.close()</span><br><span class="line"></span><br><span class="line">with CustomOpen(<span class="string">'file'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    contents = f.read()</span><br></pre></td></tr></table></figure>
<p>这只是一个常规的 Python 对象，它有两个由 <code>with</code> 语句使用的额外方法。 CustomOpen 首先被实例化，然后调用它的 <code>__enter__</code> 方法，而且 <code>__enter__</code> 的返回值在 <code>as f</code> 语句中被赋给 <code>f</code> 。 当 <code>with</code> 块中的内容执行完后，会调用 <code>__exit__</code> 方法。</p>
<p>现在我们演示生成器方式，我们将使用了 Python 自带的 <a href="https://docs.python.org/2/library/contextlib.html" target="_blank" rel="noopener">contextlib</a>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from contextlib import contextmanager</span><br><span class="line"></span><br><span class="line">@contextmanager</span><br><span class="line">def custom_open(filename):</span><br><span class="line">    f = open(filename)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> f</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">with custom_open(<span class="string">'file'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    contents = f.read()</span><br></pre></td></tr></table></figure>
<p>这与上面的类示例道理相通，尽管它更简洁。<code>custom_open</code> 函数一直运行到 <code>yield</code> 语句。 然后它将控制权返回给 <code>with</code> 语句，然后在 <code>as f</code> 部分将 yield 的 <code>f</code> 赋值给 <code>f</code>。 <code>finally</code> 确保不论 <code>with</code> 中是否发生异常， <code>close()</code> 都会被调用。</p>
<p>由于这两种方法都是一样的，所以我们应该遵循 Python 之禅来决定何时使用哪种。 如果封装的逻辑量很大，则类的方法可能会更好。 而对于处理简单操作的情况，函数方法可能会更好。</p>
<h2 id="动态类型"><a href="#动态类型" class="headerlink" title="动态类型"></a>动态类型</h2><p>Python 是动态类型语言，这意味着变量并没有固定的类型。实际上，Python 中的变量和其他语言有很大的不同，特别是静态类型语言。变量并不是计算机内存中被写入的某个值，它们只是指向内存的『标签』或『名称』。因此可能存在这样的情况，变量 <code>a</code> 先代表值 1，然后变成 字符串 <code>a string</code> , 然后又变为指向一个函数。</p>
<p>Python 的动态类型常被认为是它的缺点，的确这个特性会导致复杂度提升和难以调试的代码。 命名为 <code>a</code> 的变量可能是各种类型，开发人员或维护人员需要在代码中追踪命名，以保证它 没有被设置到毫不相关的对象上。</p>
<p>这里有些避免发生类似问题的参考方法：</p>
<ul>
<li>避免对不同类型的对象使用同一个变量名</li>
</ul>
<p><strong>不推荐</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">a = <span class="string">'a string'</span></span><br><span class="line">def a():</span><br><span class="line">    pass  <span class="comment"># Do something</span></span><br></pre></td></tr></table></figure>
<p><strong>推荐</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="number">1</span></span><br><span class="line">msg = <span class="string">'a string'</span></span><br><span class="line">def func():</span><br><span class="line">    pass  <span class="comment"># Do something</span></span><br></pre></td></tr></table></figure>
<p>使用简短的函数或方法能降低对不相关对象使用同一个名称的风险。</p>
<p>即使是相关的不同 类型的对象，也更建议使用不同命名：</p>
<p><strong>不推荐</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">items = <span class="string">'a b c d'</span>  <span class="comment"># This is a string...</span></span><br><span class="line">items = items.split(<span class="string">' '</span>)  <span class="comment"># ...becoming a list</span></span><br><span class="line">items = set(items)  <span class="comment"># ...and then a set</span></span><br></pre></td></tr></table></figure>
<p>重复使用命名对效率并没有提升：赋值时无论如何都要创建新的对象。然而随着复杂度的提升，赋值语句被其他代码包括 <code>if</code> 分支和循环分开，使得更难查明指定变量的类型。</p>
<p>在某些代码的做法中，例如函数编程，推荐的是从不重复对同一个变量命名赋值。Java 内的实现方式是使用 <code>final</code> 关键字。Python 并没有 <code>final</code> 关键字而且这与它的哲学 相悖。尽管如此，避免给同一个变量命名重复赋值仍是是个好的做法，并且有助于掌握 可变与不可变类型的概念。</p>
<h2 id="可变和不可变类型"><a href="#可变和不可变类型" class="headerlink" title="可变和不可变类型"></a>可变和不可变类型</h2><p>Python提供两种内置或用户定义的类型。</p>
<p>可变类型允许内容的内部修改。典型的动态类型 包括列表与字典：列表都有可变方法，如 <code>list.append()</code> 和 <code>list.pop()</code>， 并且能就地修改。字典也是一样。</p>
<p>不可变类型没有修改自身内容的方法。比如，赋值为整数 6 的变量 x 并没有 “自增” 方法，如果需要计算 x + 1，必须创建另一个整数变量并给其命名。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">my_list[<span class="number">0</span>] = <span class="number">4</span></span><br><span class="line"><span class="keyword">print</span> my_list  <span class="comment"># [4, 2, 3] &lt;- The same list has changed</span></span><br><span class="line"></span><br><span class="line">x = <span class="number">6</span></span><br><span class="line">x = x + <span class="number">1</span>  <span class="comment"># The new x is another object</span></span><br></pre></td></tr></table></figure>
<p>这种差异导致的一个后果就是，可变类型是不 ‘稳定 ‘的，因而不能作为字典的键使用。</p>
<p>合理地使用可变类型与不可变类型有助于阐明代码的意图。</p>
<p>例如与列表相似的不可变类型是元组， 创建方式为 <code>(1, 2)</code>。元组是不可修改的，并能作为字典的键使用。</p>
<p>Python 中一个可能会让初学者惊讶的特性是：字符串是不可变类型。这意味着当需要组合一个 字符串时，将每一部分放到一个可变列表里，使用字符串时再组合 (<code>join</code>) 起来的做法更高效。 值得注意的是，使用列表推导的构造方式比在循环中调用 <code>append()</code> 来构造列表更好也更快。</p>
<p>还有一个选项是使用 <code>map</code> 函数，它可以 <code>map</code> 一个函数 <code>str</code> 到可序列化对象上 ( 例如 <code>range(20)</code>)。 结果会产生一个集合，你可以对结果进行 <code>join</code> 在一起，就如其他的例子一样。<code>map</code> 函数在一些场景下速度会更快。</p>
<p><strong>差</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 0 到 19 创建一个连续的字符串（例如「012..1819」）</span></span><br><span class="line">nums = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> n in range(<span class="number">20</span>):</span><br><span class="line">    nums += str(n)   <span class="comment"># slow and inefficient</span></span><br><span class="line"><span class="keyword">print</span> nums</span><br></pre></td></tr></table></figure>
<p><strong>好</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 0 到 19 创建一个连续的字符串（例如「012..1819」）</span></span><br><span class="line">nums = []</span><br><span class="line"><span class="keyword">for</span> n in range(<span class="number">20</span>):</span><br><span class="line">    nums.append(str(n))</span><br><span class="line"><span class="keyword">print</span> <span class="string">""</span>.join(nums)  <span class="comment"># much more efficient</span></span><br></pre></td></tr></table></figure>
<p><strong>较好</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 0 到 19 创建一个连续的字符串（例如「012..1819」）</span></span><br><span class="line">nums = [str(n) <span class="keyword">for</span> n in range(<span class="number">20</span>)]</span><br><span class="line"><span class="keyword">print</span> <span class="string">""</span>.join(nums)</span><br></pre></td></tr></table></figure>
<p><strong>最好</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 0 到 19 创建一个连续的字符串（例如「012..1819」）</span></span><br><span class="line">nums = map(str, range(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">""</span>.join(nums)</span><br></pre></td></tr></table></figure>
<p>最后关于字符串的说明的一点是，使用 <code>join()</code> 并不总是最好的选择。比如当用预先确定数量的字符串创建一个新的字符串时，使用加法操作符确实更快，但在上文提到的情况 下或添加到已存在字符串的情况下，使用 <code>join()</code> 是更好的选择。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">foo = <span class="string">'foo'</span></span><br><span class="line">bar = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">foobar = foo + bar  <span class="comment"># This is good</span></span><br><span class="line">foo += <span class="string">'ooo'</span>  <span class="comment"># This is bad, instead you should do:</span></span><br><span class="line">foo = <span class="string">''</span>.join([foo, <span class="string">'ooo'</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>除了 <a href="http://docs.python.org/library/stdtypes.html#str.join" target="_blank" rel="noopener"><code>str.join()</code></a> 和 <code>+</code>，您也可以使用 <a href="http://docs.python.org/library/string.html#string-formatting" target="_blank" rel="noopener">%</a> 格式运算符来连接确定数量的字符串，但 <a href="https://www.python.org/dev/peps/pep-3101" target="_blank" rel="noopener">PEP 3101</a> 建议使用 <a href="http://docs.python.org/library/stdtypes.html#str.format" target="_blank" rel="noopener"><code>str.format()</code></a> 替代 <code>%</code> 操作符。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">foo = <span class="string">'foo'</span></span><br><span class="line">bar = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">foobar = <span class="string">'%s%s'</span> % (foo, bar) <span class="comment"># It is OK</span></span><br><span class="line">foobar = <span class="string">'&#123;0&#125;&#123;1&#125;'</span>.format(foo, bar) <span class="comment"># It is better</span></span><br><span class="line">foobar = <span class="string">'&#123;foo&#125;&#123;bar&#125;'</span>.format(foo=foo, bar=bar) <span class="comment"># It is best</span></span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote>
<ul>
<li><a href="https://docs.python-guide.org/writing/structure/#structure-of-the-repository" target="_blank" rel="noopener">Python漫游指南</a></li>
<li><a href="http://www.diveintopython.net/toc/index.html" target="_blank" rel="noopener">http://www.diveintopython.net/toc/index.html</a></li>
</ul>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-09-15T09:43:00.539Z" itemprop="dateUpdated">2018-09-15 17:43:00</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://yo42.github.io">
            <img src="/img/yo.jpg" alt="Neo">
            Neo
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Technology/">Technology</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/&title=《Hitchhiker's Guide to Python-代码结构》 — Neo42&pic=https://yo42.github.io/img/yo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/&title=《Hitchhiker's Guide to Python-代码结构》 — Neo42&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hitchhiker's Guide to Python-代码结构》 — Neo42&url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/&via=https://yo42.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/09/15/Hitchhiker’s-Guide-to-Python-Code-Style/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Hitchhiker&#39;s Guide to Python-Code Style</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/09/11/部署postgresql/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">部署postgresql</h4>
      </a>
    </div>
  
</nav>



    

















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Neo &copy; 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> 
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/&title=《Hitchhiker's Guide to Python-代码结构》 — Neo42&pic=https://yo42.github.io/img/yo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/&title=《Hitchhiker's Guide to Python-代码结构》 — Neo42&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hitchhiker's Guide to Python-代码结构》 — Neo42&url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/&via=https://yo42.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://yo42.github.io/2018/09/15/Hitchhiker’s-Guide-to-Python-代码结构/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>
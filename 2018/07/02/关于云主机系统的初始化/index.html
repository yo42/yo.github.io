<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>关于云主机系统的初始化 | Yo42 | Dont&#39;t Panic,Do not go gentle into that good night~</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Technology">
    <meta name="description" content="在许多IaaS平台中新购买的机器资源并不是开箱即用，一般需经过业务进行一般定制，又或者你作为一个强迫症患者想让自己的机器变得更加完美，所以在购买玩机器后进行初始化流程是很有必要滴。 机器初始化完成可以打包为云平台的镜像，方便后续的集成。 云供应商：Ucloud系统版本号：Ubuntu 16.04 LTS。关于设置机器的数据盘视情况而操作禁用系统自动更新： sed -i &apos;/Unattended-U">
<meta name="keywords" content="Technology">
<meta property="og:type" content="article">
<meta property="og:title" content="关于云主机系统的初始化">
<meta property="og:url" content="https://yo42.github.io/2018/07/02/关于云主机系统的初始化/index.html">
<meta property="og:site_name" content="Yo42">
<meta property="og:description" content="在许多IaaS平台中新购买的机器资源并不是开箱即用，一般需经过业务进行一般定制，又或者你作为一个强迫症患者想让自己的机器变得更加完美，所以在购买玩机器后进行初始化流程是很有必要滴。 机器初始化完成可以打包为云平台的镜像，方便后续的集成。 云供应商：Ucloud系统版本号：Ubuntu 16.04 LTS。关于设置机器的数据盘视情况而操作禁用系统自动更新： sed -i &apos;/Unattended-U">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-07-02T07:37:18.479Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于云主机系统的初始化">
<meta name="twitter:description" content="在许多IaaS平台中新购买的机器资源并不是开箱即用，一般需经过业务进行一般定制，又或者你作为一个强迫症患者想让自己的机器变得更加完美，所以在购买玩机器后进行初始化流程是很有必要滴。 机器初始化完成可以打包为云平台的镜像，方便后续的集成。 云供应商：Ucloud系统版本号：Ubuntu 16.04 LTS。关于设置机器的数据盘视情况而操作禁用系统自动更新： sed -i &apos;/Unattended-U">
    
        <link rel="alternate" type="application/atom+xml" title="Yo42" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/yo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Yo</h5>
          <a href="mailto:edyo7024@gmail.com" title="edyo7024@gmail.com" class="mail">edyo7024@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://yo42.github.io/Aobut-Me/"  >
                <i class="icon icon-lg icon-user"></i>
                About Me
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">关于云主机系统的初始化</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">关于云主机系统的初始化</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-07-02T07:21:19.688Z" itemprop="datePublished" class="page-time">
  2018-07-02
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Technology/">Technology</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#云供应商：Ucloud"><span class="post-toc-number">1.</span> <span class="post-toc-text">云供应商：Ucloud</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#系统版本号：Ubuntu-16-04-LTS。"><span class="post-toc-number">2.</span> <span class="post-toc-text">系统版本号：Ubuntu 16.04 LTS。</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#关于设置机器的数据盘视情况而操作"><span class="post-toc-number">3.</span> <span class="post-toc-text">关于设置机器的数据盘视情况而操作</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#禁用系统自动更新："><span class="post-toc-number">4.</span> <span class="post-toc-text">禁用系统自动更新：</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#设置别名："><span class="post-toc-number">5.</span> <span class="post-toc-text">设置别名：</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#让su-登录到root时也可以使用别名设置："><span class="post-toc-number">6.</span> <span class="post-toc-text">让su 登录到root时也可以使用别名设置：</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#修改PS1等参数（和centos保持一致）："><span class="post-toc-number">7.</span> <span class="post-toc-text">修改PS1等参数（和centos保持一致）：</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#配置内核参数："><span class="post-toc-number">8.</span> <span class="post-toc-text">配置内核参数：</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#删除废弃的设置："><span class="post-toc-number">9.</span> <span class="post-toc-text">删除废弃的设置：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加网络参数："><span class="post-toc-number">9.1.</span> <span class="post-toc-text">添加网络参数：</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#issues-1981"><span class="post-toc-number">10.</span> <span class="post-toc-text">issues-1981</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#issues-1981-1"><span class="post-toc-number">11.</span> <span class="post-toc-text">issues-1981</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加用户："><span class="post-toc-number">11.1.</span> <span class="post-toc-text">添加用户：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置sudo："><span class="post-toc-number">11.2.</span> <span class="post-toc-text">配置sudo：</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#允许普通用户使用sudo-docker-的部分命令"><span class="post-toc-number">12.</span> <span class="post-toc-text">允许普通用户使用sudo docker 的部分命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基础软件："><span class="post-toc-number">12.1.</span> <span class="post-toc-text">基础软件：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#时间同步："><span class="post-toc-number">12.2.</span> <span class="post-toc-text">时间同步：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#切换ntp到chrony："><span class="post-toc-number">12.2.1.</span> <span class="post-toc-text">切换ntp到chrony：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置chrony（根据-etc-ntp-conf中的内网IP来修改下方的2个内网IP地址）："><span class="post-toc-number">12.2.2.</span> <span class="post-toc-text">配置chrony（根据/etc/ntp.conf中的内网IP来修改下方的2个内网IP地址）：</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ntp-ubuntu-com"><span class="post-toc-number">13.</span> <span class="post-toc-text">ntp.ubuntu.com</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置开机启动："><span class="post-toc-number">13.0.1.</span> <span class="post-toc-text">设置开机启动：</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装zabbix：待操作。"><span class="post-toc-number">13.1.</span> <span class="post-toc-text">安装zabbix：待操作。</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加docker支持："><span class="post-toc-number">13.2.</span> <span class="post-toc-text">添加docker支持：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#先禁用docker随机启动："><span class="post-toc-number">13.3.</span> <span class="post-toc-text">先禁用docker随机启动：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理安装包："><span class="post-toc-number">13.4.</span> <span class="post-toc-text">清理安装包：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#选择vim-tiny作为默认编辑器："><span class="post-toc-number">13.5.</span> <span class="post-toc-text">选择vim.tiny作为默认编辑器：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置SSHD："><span class="post-toc-number">13.6.</span> <span class="post-toc-text">配置SSHD：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#防火墙（具体规则还需根据实际情况进行修改）："><span class="post-toc-number">13.7.</span> <span class="post-toc-text">防火墙（具体规则还需根据实际情况进行修改）：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#禁用ufw："><span class="post-toc-number">13.7.1.</span> <span class="post-toc-text">禁用ufw：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安装（默认是交互式，保存IPv4的规则就可以了）："><span class="post-toc-number">13.7.2.</span> <span class="post-toc-text">安装（默认是交互式，保存IPv4的规则就可以了）：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#iptables配置文件："><span class="post-toc-number">13.7.3.</span> <span class="post-toc-text">iptables配置文件：</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#intranet"><span class="post-toc-number">14.</span> <span class="post-toc-text">intranet</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#apt-get-mirrors-163-com"><span class="post-toc-number">15.</span> <span class="post-toc-text">apt-get mirrors.163.com</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#dns-server"><span class="post-toc-number">16.</span> <span class="post-toc-text">dns server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#drop-all"><span class="post-toc-number">17.</span> <span class="post-toc-text">drop all</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#禁用无用的服务："><span class="post-toc-number">17.1.</span> <span class="post-toc-text">禁用无用的服务：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#重启系统：确保配置正常。"><span class="post-toc-number">17.2.</span> <span class="post-toc-text">重启系统：确保配置正常。</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">17.3.</span> <span class="post-toc-text">参考资料</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-关于云主机系统的初始化"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">关于云主机系统的初始化</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-07-02 15:21:19" datetime="2018-07-02T07:21:19.688Z"  itemprop="datePublished">2018-07-02</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Technology/">Technology</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>在许多IaaS平台中新购买的机器资源并不是开箱即用，一般需经过业务进行一般定制，又或者你作为一个强迫症患者想让自己的机器变得更加完美，所以在购买玩机器后进行初始化流程是很有必要滴。</p>
<p>机器初始化完成可以打包为云平台的镜像，方便后续的集成。</p>
<h1 id="云供应商：Ucloud"><a href="#云供应商：Ucloud" class="headerlink" title="云供应商：Ucloud"></a>云供应商：Ucloud</h1><h1 id="系统版本号：Ubuntu-16-04-LTS。"><a href="#系统版本号：Ubuntu-16-04-LTS。" class="headerlink" title="系统版本号：Ubuntu 16.04 LTS。"></a>系统版本号：Ubuntu 16.04 LTS。</h1><h1 id="关于设置机器的数据盘视情况而操作"><a href="#关于设置机器的数据盘视情况而操作" class="headerlink" title="关于设置机器的数据盘视情况而操作"></a>关于设置机器的数据盘视情况而操作</h1><h1 id="禁用系统自动更新："><a href="#禁用系统自动更新：" class="headerlink" title="禁用系统自动更新："></a>禁用系统自动更新：</h1><pre>
sed -i '/Unattended-Upgrade/s/1/0/' /etc/apt/apt.conf.d/20auto-upgrades
</pre>


<h1 id="设置别名："><a href="#设置别名：" class="headerlink" title="设置别名："></a>设置别名：</h1><pre>
cat<<\eof> /etc/profile.d/Env.sh
alias grep='grep --color'
alias fgrep='fgrep --color'
alias pgrep='pgrep -l'
alias l.='ls -d .* --color=auto'
alias ll='ls -l --color=auto'
alias ls='ls --color=auto'
alias lt='ls -l --time-style=long-iso'
HISTFILESIZE=50000
HISTSIZE=10000
HISTTIMEFORMAT="<%f %t="">: " 
export HISTTIMEFORMAT HISTSIZE HISTFILESIZE
export MYSQL_HISTFILE=/dev/null
EOF
</%f></\eof></pre>

<h1 id="让su-登录到root时也可以使用别名设置："><a href="#让su-登录到root时也可以使用别名设置：" class="headerlink" title="让su 登录到root时也可以使用别名设置："></a>让su 登录到root时也可以使用别名设置：</h1><pre>
cat<<\eof>> /etc/bash.bashrc

if [ -d /etc/profile.d ]; then
  for i in /etc/profile.d/*.sh; do
    if [ -r $i ]; then
      . $i
    fi
  done
  unset i
fi
EOF
</\eof></pre>

<h1 id="修改PS1等参数（和centos保持一致）："><a href="#修改PS1等参数（和centos保持一致）：" class="headerlink" title="修改PS1等参数（和centos保持一致）："></a>修改PS1等参数（和centos保持一致）：</h1><pre>
vim /etc/skel/.bashrc 
# 注释第19、20行。（HISTSIZE=1000和HISTFILESIZE=2000）
# 注释第62行，并在下方加入：
PS1='${debian_chroot:+($debian_chroot)}[\u@\h \W]\$ '
# 注释第89行。（alias ll='ls -alF'）

vim /etc/bash.bashrc 
# 注释第19行，并在下方加入：
PS1='${debian_chroot:+($debian_chroot)}[\u@\h \W]\$ '


vim /root/.bashrc
# 注释第16、17行。
# 注释第55行，并在下方加入：
PS1='${debian_chroot:+($debian_chroot)}[\u@\h \W]\$ '
# 注释第82行。
</pre>

<h1 id="配置内核参数："><a href="#配置内核参数：" class="headerlink" title="配置内核参数："></a>配置内核参数：</h1><pre>
sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT="/& ipv6.disable=1 /' /etc/default/grub
grub-mkconfig -o /boot/grub/grub.cfg
</pre>

<h1 id="删除废弃的设置："><a href="#删除废弃的设置：" class="headerlink" title="删除废弃的设置："></a>删除废弃的设置：</h1><pre>
sed -i '/GREP_OPTIONS/d' /etc/profile
</pre>

<h2 id="添加网络参数："><a href="#添加网络参数：" class="headerlink" title="添加网络参数："></a>添加网络参数：</h2><p><pre><br>cat&lt;<eof> /etc/sysctl.d/Net.conf<br>net.ipv4.ip_forward = 1<br>net.bridge.bridge-nf-call-iptables = 1<br>net.bridge.bridge-nf-call-ip6tables= 1</eof></pre></p>
<h1 id="issues-1981"><a href="#issues-1981" class="headerlink" title="issues-1981"></a>issues-1981</h1><p>net.ipv4.tcp_syncookies  = 1<br>net.ipv4.tcp_syn_retries = 1<br>net.ipv4.tcp_synack_retries  = 1<br>net.ipv4.tcp_max_syn_backlog = 32768<br>net.core.netdev_max_backlog  = 32768<br>net.core.somaxconn = 32769</p>
<h1 id="issues-1981-1"><a href="#issues-1981-1" class="headerlink" title="issues-1981"></a>issues-1981</h1><p>EOF<br></p>
<h2 id="添加用户："><a href="#添加用户：" class="headerlink" title="添加用户："></a>添加用户：</h2><p><pre><br>if ! grep -q usertest /etc/passwd ;then<br>    [ $retvar -eq 0 ] &amp;&amp; /usr/sbin/useradd -m -s /bin/bash usertest \<br>        &amp;&amp; chpasswd –encrypted &lt;&lt;\EOF<br>usertest:$6$aaUa0aRG$9cgxRe/Ap3mxK.tSROljfIR06DrC5qoM.ygURHJdHJo4NdB92qdCVl5ELCZIucifF8z8Y7FIleYcVJD9VN6Kc/<br>EOF<br>retvar=$?<br>fi<br></pre></p>
<h2 id="配置sudo："><a href="#配置sudo：" class="headerlink" title="配置sudo："></a>配置sudo：</h2><p><pre></pre></p>
<h1 id="允许普通用户使用sudo-docker-的部分命令"><a href="#允许普通用户使用sudo-docker-的部分命令" class="headerlink" title="允许普通用户使用sudo docker 的部分命令"></a>允许普通用户使用sudo docker 的部分命令</h1><p>retvar=0<br>[ $retvar -eq 0 ] &amp;&amp; cat&lt;&lt;\EOF &gt; /etc/sudoers.d/docker<br>cilu ALL=(ALL) NOPASSWD:/usr/bin/docker,/usr/bin/docker-compose<br>EOF<br>retvar=$?<br>[ $retvar -eq 0 ] &amp;&amp; chmod 440 /etc/sudoers.d/docker<br></p>
<h2 id="基础软件："><a href="#基础软件：" class="headerlink" title="基础软件："></a>基础软件：</h2><p><pre><br>apt-get update<br>apt-get install -y aptitude<br></pre></p>
<h2 id="时间同步："><a href="#时间同步：" class="headerlink" title="时间同步："></a>时间同步：</h2><h3 id="切换ntp到chrony："><a href="#切换ntp到chrony：" class="headerlink" title="切换ntp到chrony："></a>切换ntp到chrony：</h3><p><pre><br>aptitude remove  -y ntp<br>aptitude install -y chrony<br></pre></p>
<h3 id="配置chrony（根据-etc-ntp-conf中的内网IP来修改下方的2个内网IP地址）："><a href="#配置chrony（根据-etc-ntp-conf中的内网IP来修改下方的2个内网IP地址）：" class="headerlink" title="配置chrony（根据/etc/ntp.conf中的内网IP来修改下方的2个内网IP地址）："></a>配置chrony（根据/etc/ntp.conf中的内网IP来修改下方的2个内网IP地址）：</h3><p><pre><br>cat&lt;<eof> /etc/chrony/chrony.conf<br>server 10.13.255.1    iburst minpoll 3 maxpoll 4 prefer<br>server 10.13.255.2    iburst minpoll 3 maxpoll 4 prefer<br>server 182.92.12.11  iburst minpoll 3 maxpoll 4</eof></pre></p>
<h1 id="ntp-ubuntu-com"><a href="#ntp-ubuntu-com" class="headerlink" title="ntp.ubuntu.com"></a>ntp.ubuntu.com</h1><p>server 91.189.91.157 iburst minpoll 3 maxpoll 4<br>server 91.189.89.199 iburst minpoll 3 maxpoll 4</p>
<p>stratumweight 0<br>driftfile /var/lib/chrony/drift<br>rtcsync<br>makestep 10 3<br>bindcmdaddress 127.0.0.1<br>bindcmdaddress ::1<br>keyfile /etc/chrony/chrony.keys<br>commandkey 1<br>generatecommandkey</p>
<p>#log    statistics<br>logdir /var/log/chrony<br>logchange 0.1<br>noclientlog<br>EOF<br></p>
<h3 id="设置开机启动："><a href="#设置开机启动：" class="headerlink" title="设置开机启动："></a>设置开机启动：</h3><p><pre><br>/lib/systemd/systemd-sysv-install enable chrony<br></pre></p>
<h2 id="安装zabbix：待操作。"><a href="#安装zabbix：待操作。" class="headerlink" title="安装zabbix：待操作。"></a>安装zabbix：待操作。</h2><h2 id="添加docker支持："><a href="#添加docker支持：" class="headerlink" title="添加docker支持："></a>添加docker支持：</h2><p><pre><br>aptitude install -y docker.io docker-compose<br></pre></p>
<h2 id="先禁用docker随机启动："><a href="#先禁用docker随机启动：" class="headerlink" title="先禁用docker随机启动："></a>先禁用docker随机启动：</h2><p><pre><br>systemctl disable docker<br>systemctl stop docker<br></pre></p>
<h2 id="清理安装包："><a href="#清理安装包：" class="headerlink" title="清理安装包："></a>清理安装包：</h2><p><pre><br>aptitude clean<br></pre></p>
<h2 id="选择vim-tiny作为默认编辑器："><a href="#选择vim-tiny作为默认编辑器：" class="headerlink" title="选择vim.tiny作为默认编辑器："></a>选择vim.tiny作为默认编辑器：</h2><p><pre><br>sudo update-alternatives –config editor<br></pre></p>
<h2 id="配置SSHD："><a href="#配置SSHD：" class="headerlink" title="配置SSHD："></a>配置SSHD：</h2><p><pre><br>retvar=0<br>if ! grep -q X_FLAG_X /etc/ssh/ssh_config ;then<br>    [ $retvar -eq 0 ] \<br>        &amp;&amp; sed -e ‘s/^Port/#&amp;/‘                     \<br>           -e ‘s/^UsePAM/#&amp;/‘                   \<br>           -e ‘s/^Protocol/#&amp;/‘                 \<br>           -e ‘s/^X11Forwarding/#&amp;/‘            \<br>           -e ‘s/^PermitRootLogin/#&amp;/‘          \<br>           -e ‘s/^AuthorizedKeysFile/#&amp;/‘       \<br>           -e ‘s/^PubkeyAuthentication/#&amp;/‘     \<br>           -e ‘s/^PermitEmptyPasswords/#&amp;/‘     \<br>           -e ‘s/^GSSAPIAuthentication/#&amp;/‘     \<br>           -e ‘s/^PasswordAuthentication/#&amp;/‘   \<br>           -e ‘s/^GSSAPICleanupCredentials/#&amp;/‘ \<br>           -e ‘s/^ChallengeResponseAuthentication/#&amp;/‘ \<br>           /etc/ssh/sshd_config -i \<br>        &amp;&amp; cat &lt;&lt;\EOF &gt;&gt; /etc/ssh/sshd_config<br>Port     932<br>Protocol 2<br>PermitRootLogin        no<br>PermitEmptyPasswords   no<br>PasswordAuthentication no<br>PubkeyAuthentication   yes<br>UseLogin               yes<br>AuthorizedKeysFile     .ssh/authorized_keys<br>ChallengeResponseAuthentication no<br>UsePAM yes<br>UseDNS no<br>X11Forwarding no<br>GSSAPIAuthentication no<br>GSSAPICleanupCredentials no<br>EOF<br>retvar=$?</pre></p>
<pre><code>[ $retvar -eq 0 ] \
    &amp;&amp; sed -i &apos;s/GSSAPIAuthentication/#&amp;/&apos; /etc/ssh/ssh_config \
    &amp;&amp; cat &lt;&lt;\EOF &gt;&gt; /etc/ssh/ssh_config
    Port 932
    ForwardAgent yes
    # X_FLAG_X #
</code></pre><p>EOF<br>retvar=$?<br>fi<br></p>
<h2 id="防火墙（具体规则还需根据实际情况进行修改）："><a href="#防火墙（具体规则还需根据实际情况进行修改）：" class="headerlink" title="防火墙（具体规则还需根据实际情况进行修改）："></a>防火墙（具体规则还需根据实际情况进行修改）：</h2><h3 id="禁用ufw："><a href="#禁用ufw：" class="headerlink" title="禁用ufw："></a>禁用ufw：</h3><p><pre><br>systemctl stop ufw<br>systemctl disable ufw<br>systemctl mask ufw<br></pre></p>
<h3 id="安装（默认是交互式，保存IPv4的规则就可以了）："><a href="#安装（默认是交互式，保存IPv4的规则就可以了）：" class="headerlink" title="安装（默认是交互式，保存IPv4的规则就可以了）："></a>安装（默认是交互式，保存IPv4的规则就可以了）：</h3><p><pre><br>aptitude install iptables-persistent<br></pre></p>
<h3 id="iptables配置文件："><a href="#iptables配置文件：" class="headerlink" title="iptables配置文件："></a>iptables配置文件：</h3><p><pre><br>cat&lt;&lt;\EOF &gt; /etc/iptables/rules.v4<br>*filter<br>:INPUT   ACCEPT [0:0]<br>:FORWARD ACCEPT [0:0]<br>:OUTPUT  ACCEPT [0:0]<br>-A INPUT -p icmp –icmp-type timestamp-request -j DROP<br>-A INPUT -p icmp –icmp-type timestamp-reply   -j DROP<br>-A INPUT -p icmp -j ACCEPT<br>-A INPUT -i lo   -j ACCEPT<br>-A INPUT -i docker0 -j ACCEPT<br>-A INPUT -m state –state RELATED,ESTABLISHED -j ACCEPT<br>-A INPUT -s 10.23.0.0/16       -m comment –comment “intranet” -p tcp -m tcp -j ACCEPT<br>-A INPUT -p tcp -m tcp -m multiport –dports 80,443 -m comment –comment “all-user” -j ACCEPT<br>-A INPUT -j REJECT –reject-with icmp-host-prohibited<br>-A FORWARD -o docker0 -m conntrack –ctstate RELATED,ESTABLISHED -j ACCEPT<br>-A FORWARD -i docker0 ! -o docker0 -m conntrack –ctstate RELATED,ESTABLISHED -j ACCEPT<br>-A FORWARD -i docker0   -o docker0 -j ACCEPT</pre></p>
<h1 id="intranet"><a href="#intranet" class="headerlink" title="intranet"></a>intranet</h1><p>-A FORWARD -d 10.25.0.0/16       -i docker0 ! -o docker0 -j ACCEPT</p>
<h1 id="apt-get-mirrors-163-com"><a href="#apt-get-mirrors-163-com" class="headerlink" title="apt-get mirrors.163.com"></a>apt-get mirrors.163.com</h1><p>-A FORWARD -d 123.58.173.185/32 -i docker0 ! -o docker0 -j ACCEPT<br>-A FORWARD -d 123.58.173.186/32 -i docker0 ! -o docker0 -j ACCEPT</p>
<h1 id="dns-server"><a href="#dns-server" class="headerlink" title="dns server"></a>dns server</h1><p>-A FORWARD -d 10.23.255.1/32     -i docker0 ! -o docker0 -j ACCEPT<br>-A FORWARD -d 10.23.255.2/32     -i docker0 ! -o docker0 -j ACCEPT<br>-A FORWARD -d 114.114.114.114/32 -i docker0 ! -o docker0 -j ACCEPT</p>
<h1 id="drop-all"><a href="#drop-all" class="headerlink" title="drop all"></a>drop all</h1><p>-A FORWARD -i docker0 ! -o docker0 -j DROP<br>-A FORWARD -j DROP<br>-A OUTPUT -p icmp -j ACCEPT<br>-A OUTPUT -m state –state RELATED,ESTABLISHED -j ACCEPT<br>-A OUTPUT -d 10.23.0.0/16       -m comment –comment “intranet” -p tcp -m tcp -j ACCEPT<br>-A OUTPUT -d 10.23.255.1/32     -m comment –comment “dns” -p udp -m udp –dport 53  -j ACCEPT<br>-A OUTPUT -d 10.23.255.1/32     -m comment –comment “dns” -p udp -m udp –dport 53  -j ACCEPT<br>-A OUTPUT -d 114.114.114.114/32 -m comment –comment “dns” -p udp -m udp –dport 53  -j ACCEPT<br>-A OUTPUT -d 10.23.255.101/32   -m comment –comment “ntp” -p udp -m udp –dport 123 -j ACCEPT<br>-A OUTPUT -d 10.23.255.102/32   -m comment –comment “ntp” -p udp -m udp –dport 123 -j ACCEPT<br>-A OUTPUT -d 182.92.12.11/32    -m comment –comment “ntp” -p udp -m udp –dport 123 -j ACCEPT<br>-A OUTPUT -o lo      -j ACCEPT<br>-A OUTPUT -o docker0 -j ACCEPT<br>-A OUTPUT -j REJECT –reject-with icmp-host-prohibited<br>COMMIT<br>EOF<br></p>
<h2 id="禁用无用的服务："><a href="#禁用无用的服务：" class="headerlink" title="禁用无用的服务："></a>禁用无用的服务：</h2><p><pre><br>systemctl stop    iscsid<br>systemctl disable iscsid<br>systemctl mask    iscsid<br></pre></p>
<h2 id="重启系统：确保配置正常。"><a href="#重启系统：确保配置正常。" class="headerlink" title="重启系统：确保配置正常。"></a>重启系统：确保配置正常。</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote>
<ul>
<li><a href=""></a></li>
<li><a href=""></a></li>
</ul>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-07-02T07:37:18.479Z" itemprop="dateUpdated">2018-07-02 15:37:18</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://yo42.github.io">
            <img src="/img/yo.jpg" alt="Yo">
            Yo
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Technology/">Technology</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/&title=《关于云主机系统的初始化》 — Yo42&pic=https://yo42.github.io/img/yo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/&title=《关于云主机系统的初始化》 — Yo42&source=aaa" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《关于云主机系统的初始化》 — Yo42&url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/&via=https://yo42.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/06/25/许三观卖血记/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">许三观卖血记</h4>
      </a>
    </div>
  
</nav>



    

















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Yo &copy; 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> 
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/&title=《关于云主机系统的初始化》 — Yo42&pic=https://yo42.github.io/img/yo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/&title=《关于云主机系统的初始化》 — Yo42&source=aaa" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《关于云主机系统的初始化》 — Yo42&url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/&via=https://yo42.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://yo42.github.io/2018/07/02/关于云主机系统的初始化/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










</body>
</html>
